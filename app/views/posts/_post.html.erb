<!-- app/views/posts/_post.html.erb -->
<div class="card border-0" style="width: 18rem; position: relative;">
  <%= link_to post_path(post) do %>
    <div class="card-img-container">
      <% if post.photo.attached? %>
        <%= cl_image_tag(post.photo.key, class: "card-img-top rounded", transformation: [
              { width: 500, crop: "scale" },
              { quality: "auto", fetch_format: "auto" }
            ]) %>
      <% else %>
        <img src="https://via.placeholder.com/150" class="card-img-top rounded" alt="Default Image">
      <% end %>
    </div>
  <% end %>
  <div class="tags-overlay">
    <% post.categories.each do |category| %>
      <p class="badge"><%= category.name %></p>
    <% end %>
  </div>
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center">
      <h5 class="card-title mb-0" style="font-family: 'Inter-SemiBold', Helvetica; font-size: 20px; font-weight: 600;"><%= post.title %></h5>
      <% if current_user %>
        <% is_favorited = current_user.favorites.exists?(post_id: post.id) %>
        <%= form_with(model: (is_favorited ? current_user.favorites.find_by(post_id: post.id) : Favorite.new), url: (is_favorited ? post_favorite_path(post) : post_favorites_path(post)), method: (is_favorited ? :delete : :post), remote: true, data: { controller: "favorite", action: "favorite#toggleFavorite" }) do |f| %>
          <%= f.hidden_field :post_id, value: post.id %>
          <%= button_tag type: 'submit', class: 'favorite-btn', data: { action: "favorite#toggleFavorite", favorite_target: "button" } do %>
            <i class="fa-solid fa-heart <%= is_favorited ? 'favorite' : '' %>" style="color: <%= is_favorited ? '#ec0941' : '#707b8f' %>;" data-favorite-target="icon"></i>
          <% end %>
        <% end %>
      <% end %>
    </div>
    <p class="card-text"><%= post.user.nickname %></p>
  </div>
  <div class="card-body d-flex justify-content-between align-items-center">
    <%= link_to "En lire +", post, class: "btn custom-btn" %>
  </div>
</div>

